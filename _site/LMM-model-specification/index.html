<!DOCTYPE html>
<html>
  <head>
    <title>Model specification for linear mixed model – Alexej Gossmann</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Last week I wrote about my implementation of an algorithm that fits a linear mixed model in Ruby using the gem MixedModels, that I am working on right now. See, first rudimentary LMM fit.

" />
    <meta property="og:description" content="Last week I wrote about my implementation of an algorithm that fits a linear mixed model in Ruby using the gem MixedModels, that I am working on right now. See, first rudimentary LMM fit.

" />
    
    <meta name="author" content="Alexej Gossmann" />

    
    <meta property="og:title" content="Model specification for linear mixed model" />
    <meta property="twitter:title" content="Model specification for linear mixed model" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Alexej Gossmann - PhD student with (severely sleep deprived) focus on statistics, machine learning, and programming" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->

    <!-- MathJax integration and configuration-->
    <!-- Use standard LaTeX delimiters and turn on equation numbering -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ["$","$"] ],
        displayMath: [ ["$$","$$"] ],
        processEscapes: true
      },
      TeX: {
        equationNumbers: { autoNumber: "AMS" },
        Macros: {
          subscript: ['_{#1}', 1],
          superscript: ['^{#1}', 1]
        }
      }
    });
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML-full">
    </script>
 </head>

  <body>
    <div class="wrapper-masthead">
      <header class="masthead clearfix">
        <a href="/" class="site-avatar"><img src="/images/avatar.png" /></a>

        <div class="site-info">
          <h1 class="site-name"><a href="/">Alexej Gossmann</a></h1>
          <p class="site-description">PhD student with (severely sleep deprived) focus on statistics, machine learning, and programming</p>
        </div>

        <nav>
          <a href="/">/blog/</a>
          <a href="/publications">/publications/</a>
          <a href="/code">/code/</a>
          <a href="/about">/about/</a>
        </nav>
      </header>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>Model specification for linear mixed model</h1>

  <div class="entry">
    <p>Last week I wrote about my implementation of an algorithm that fits a linear mixed model in Ruby using the gem <a href="https://github.com/agisga/MixedModels">MixedModels</a>, that I am working on right now. See, <a href="http://agisga.github.io/First-linear-mixed-model-fit/">first rudimentary LMM fit</a>.</p>

<p>The currently available interface to the method is rather unfriendly to the user. First, I was planning on reproducing the interface of the R mixed models library lme4, but that appears to be too complicated and too time consuming. I spend some time thinking about what to do instead. Below, I present an idea and it’s comparison to the lme4 interface in R. In particular, I want to write a more user-friendly initialization method <code class="highlighter-rouge">LMM#from_daru</code> that will work on <a href="https://github.com/v0dro/daru">daru</a> data sets.</p>

<h3 id="random-intercept-model">Random intercept model</h3>

<p>Simplest model. The i’th observation of “yield” in the j’th batch is modeled as:</p>

<script type="math/tex; mode=display">Yield\subscript{ij} = Intercept + BatchEffect\subscript{j} + RandomError\subscript{ij},</script>

<p>where “Intercept” is the overall mean, and “BatchEffect” denotes a random effect due to the batch that the i’th observation was in.</p>

<p>In lme4 (R):</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">fm01</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">Yield</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">Batch</span><span class="p">),</span><span class="w"> </span><span class="n">Dyestuff</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>In MixedModels (Ruby):</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">fm01</span> <span class="o">=</span> <span class="no">LMM</span><span class="p">.</span><span class="nf">from_daru</span><span class="p">(</span><span class="ss">response: :yield</span><span class="p">,</span>
                     <span class="ss">fixed_effects: :intercept</span><span class="p">,</span>
                     <span class="ss">random_effects: :intercept</span><span class="p">,</span>
                     <span class="ss">grouping: :batch</span><span class="p">,</span>
                     <span class="ss">data: </span><span class="n">dyestuff</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="crossed-random-effects">Crossed random effects</h3>

<p>Simple crossed random effects. The i’th observation of “diameter” in the j’th “sample” from the k’th “plate” is modeled as:</p>

<script type="math/tex; mode=display">diameter\subscript{ijk} = Intercept + SampleIntercept\subscript{j} + PlateIntercept\subscript{k} + RandomError\subscript{ij},</script>

<p>where “Intercept” is the overall average, and “SampleIntercept” as well as “PlateIntercept” are random intercept terms, due to the sample and plate that a particular observation comes from.</p>

<p>In R, lme4:</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">fm03</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">diameter</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">plate</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">sample</span><span class="p">),</span><span class="w"> </span><span class="n">Penicillin</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>In Ruby, MixedModels:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">fm03</span> <span class="o">=</span> <span class="no">LMM</span><span class="p">.</span><span class="nf">from_daru</span><span class="p">(</span><span class="ss">response: :diameter</span><span class="p">,</span>
                     <span class="ss">fixed_effects: :intercept</span><span class="p">,</span>
                     <span class="ss">random_effects: </span><span class="p">[</span><span class="ss">:intercept</span><span class="p">,</span> <span class="ss">:intercept</span><span class="p">],</span>
                     <span class="ss">grouping: </span><span class="p">[</span><span class="ss">:plate</span><span class="p">,</span> <span class="ss">:sample</span><span class="p">],</span>
                     <span class="ss">data: </span><span class="n">penicillin</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="nested-random-effects">Nested random effects</h3>

<p>The i’th observation of “BoneGrowth” in the m’th “digit” of the k’th “foot” of the j’th “mouse” can be modelled as:</p>

<script type="math/tex; mode=display">BoneGrowth\subscript{ijkm} = Intercept +  MouseIntercept\subscript{j} + FootIntercept\subscript{kj} + RandomError\subscript{ijkm},</script>

<p>i.e. the random effect “foot” only appears as nested within “mouse” (i.e. the intercept due to foot 1 in mouse 1 is different than the intercept due to foot 1 in mouse 2).</p>

<p>In R, lme4:</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">bone.growth.lmer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">BoneGrowth</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">mouse</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">mouse</span><span class="o">:</span><span class="n">foot</span><span class="p">),</span><span class="w"> 
                         </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>or more succinct:</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">bone.growth.lmer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">BoneGrowth</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">mouse</span><span class="o">/</span><span class="n">foot</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>In Ruby, MixedModels: Construct additional data frame columns, describing the interaction of foot and mouse, by hand. Then fit a model as shown above for crossed random effects…</p>

<h3 id="random-slopes">Random slopes.</h3>

<p>The i’th observation of “politeness” in the j’th subject and the k’th scenario is modeled as:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{eqnarray} 
Politeness\subscript{ijk} &=& Intercept + SubjectIntercept\subscript{j} + ScenarioIntercept\subscript{k} \nonumber \\
 &+& IsFemale\subscript{ijk} \cdot FixedEffect + IQ\subscript{ijk} \cdot AnotherFixedEffect \nonumber \\
&+& Attitude\subscript{ijk} \cdot SubjectSlope\subscript{j} + Attitude\subscript{ijk} \cdot ScenarioSlope\subscript{k} \nonumber \\
 &+& RandomError\subscript{ijk}, \nonumber 
\end{eqnarray} %]]></script>

<p>where we assume a random intercept and slope due to “subject”, and a random intercept and slope due to “scenario”.</p>

<p>This can be expressed in R as:</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">politeness.model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">politeness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">IQ</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="n">attitude</span><span class="o">|</span><span class="n">subject</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="n">attitude</span><span class="o">|</span><span class="n">scenario</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">politeness</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>And the equivalent in Ruby would be:</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">politeness_model</span> <span class="o">=</span> <span class="no">LMM</span><span class="p">.</span><span class="nf">from_daru</span><span class="p">(</span><span class="ss">response: :politeness</span><span class="p">,</span>
                                 <span class="ss">fixed_effects: </span><span class="p">[</span><span class="ss">:gender</span><span class="p">,</span> <span class="ss">:IQ</span><span class="p">],</span>
                                 <span class="ss">random_efffects: </span><span class="p">[</span> <span class="p">[</span><span class="ss">:intercept</span><span class="p">,</span> <span class="ss">:attitude</span><span class="p">],</span> <span class="p">[</span><span class="ss">:intercept</span><span class="p">,</span> <span class="ss">:attitude</span><span class="p">]</span> <span class="p">],</span>
                                 <span class="ss">grouping: </span><span class="p">[</span><span class="ss">:subject</span><span class="p">,</span> <span class="ss">:scenario</span><span class="p">],</span>
                                 <span class="ss">data: </span><span class="n">politeness</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="interaction-effects-and-transformations-of-the-fixed-effects">Interaction effects, and transformations of the fixed effects</h3>

<p>We model the i’th observation in the j’th batch as:</p>

<script type="math/tex; mode=display">z\subscript{ij} = \beta\subscript{0} + x\subscript{ij} \cdot \beta\subscript{1} + x\subscript{ij}^2 \cdot \beta\subscript{2} + y\subscript{ij} \cdot \beta\subscript{3} + x\subscript{ij}y\subscript{ij} \cdot \beta\subscript{4} + u\subscript{j} + \epsilon\subscript{ij},</script>

<p>where $u\subscript{j}$ denotes the random intercept of the j’th batch and $\epsilon\subscript{ij}$ is the random error.</p>

<p>In R, lme4:</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">modfit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">z</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">u</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>In Ruby, MixedModels: By hand, generate new columns to the <code class="highlighter-rouge">daru</code> data frame. Namely, a column containing the squares of $x$ and a column containing the products $xy$. Then call <code class="highlighter-rouge">LMM#from_daru</code> as,</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="n">modfit</span> <span class="o">=</span> <span class="no">LMM</span><span class="p">.</span><span class="nf">from_daru</span><span class="p">(</span><span class="ss">response: :z</span><span class="p">,</span>
                       <span class="ss">fixed_effects: </span><span class="p">[</span><span class="ss">:intercept</span><span class="p">,</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:x2</span><span class="p">,</span> <span class="ss">:y</span><span class="p">,</span> <span class="ss">:xy</span><span class="p">],</span>
                       <span class="ss">random_effects: :intercept</span><span class="p">,</span>
                       <span class="ss">grouping: :u</span><span class="p">,</span>
                       <span class="ss">data: </span><span class="n">your_xyzu_data</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="summary">Summary</h3>

<p>This list of examples is most likely far from exhaustive, but it presents some of the most common types of linear mixed model fits.</p>

<p>Disadvantages of my proposed model specification interface for Ruby compared to R:</p>

<ul>
  <li>Lengthy</li>
  <li>No interaction effects</li>
  <li>No nested effects</li>
  <li>No transformations of predictors</li>
  <li>…</li>
</ul>


  </div>

  <div class="date">
    Written on June 12, 2015
  </div>

  <div class="date">
    Tags:
    
    <a href="/tag/ruby">#ruby</a>
    
    <a href="/tag/mixed_models">#mixed_models</a>
    
    <a href="/tag/lme4">#lme4</a>
    
    <a href="/tag/regression">#regression</a>
    
    <a href="/tag/LMM">#LMM</a>
    
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'agisga';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:alexej.go@gmail.com"><i class="svg-icon email"></i></a>
<a href="https://www.facebook.com/alexej.yexela"><i class="svg-icon facebook"></i></a>

<a href="https://github.com/agisga"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in/alexejgossmann"><i class="svg-icon linkedin"></i></a>

<a href="/feed.xml"><i class="svg-icon rss"></i></a>




        </footer>
      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-94080131-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/LMM-model-specification/',
		  'title': 'Model specification for linear mixed model'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>
