<!DOCTYPE html>
<html>
  <head>
    <title>5 ways to measure running time of R code – Alexej Gossmann</title>

        <meta charset="utf-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    
    <meta name="description" content="A reviewer asked me to report detailed running times for all (so many :scream:) performed computations in one of my papers, and so I spent a Saturday morning figuring out my favorite way to benchmark R code. This is a quick summary of the options I found to be available.

">
    <meta property="og:description" content="A reviewer asked me to report detailed running times for all (so many :scream:) performed computations in one of my papers, and so I spent a Saturday morning figuring out my favorite way to benchmark R code. This is a quick summary of the options I found to be available.

">
    
    <meta name="author" content="Alexej Gossmann">

    
    <meta property="og:title" content="5 ways to measure running time of R code">
    <meta property="twitter:title" content="5 ways to measure running time of R code">
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="alternate" type="application/rss+xml" title="Alexej Gossmann - PhD student with (severely sleep deprived) focus on statistics, machine learning, and programming" href="/feed.xml">

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->

    <!-- MathJax integration and configuration-->
    <!-- Use standard LaTeX delimiters and turn on equation numbering -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ["$","$"] ],
        displayMath: [ ["$$","$$"] ],
        processEscapes: true
      },
      TeX: {
        equationNumbers: { autoNumber: "AMS" },
        Macros: {
          subscript: ['_{#1}', 1],
          superscript: ['^{#1}', 1]
        }
      }
    });
    </script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML-full">
    </script>
 </head>

  <body>
    <div class="wrapper-masthead">
      <header class="masthead clearfix">
        <a href="/" class="site-avatar"><img src="/images/avatar.png"></a>

        <div class="site-info">
          <h1 class="site-name"><a href="/">Alexej Gossmann</a></h1>
          <p class="site-description">PhD student with (severely sleep deprived) focus on statistics, machine learning, and programming</p>
        </div>

        <nav>
          <a href="/">/blog/</a>
          <a href="/publications">/publications/</a>
          <a href="/code">/code/</a>
          <a href="/about">/about/</a>
        </nav>
      </header>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>5 ways to measure running time of R code</h1>

  <div class="entry">
    <p>A reviewer asked me to report detailed running times for all (so many <img class="emoji" title=":scream:" alt=":scream:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f631.png" height="20" width="20">) performed computations in one of my papers, and so I spent a Saturday morning figuring out my favorite way to benchmark R code. This is a quick summary of the options I found to be available.</p>

<p>A quick online search revealed at least three R packages for benchmarking R code (<code class="highlighter-rouge">rbenchmark</code>, <code class="highlighter-rouge">microbenchmark</code>, and <code class="highlighter-rouge">tictoc</code>). Additionally, base R provides at least two methods to measure the running time of R code (<code class="highlighter-rouge">Sys.time</code> and <code class="highlighter-rouge">system.time</code>). In the following I briefly go through the syntax of using each of the five option, and present my conclusions at the end.</p>

<h3 id="1-using-systime">1. Using <code class="highlighter-rouge">Sys.time</code>
</h3>

<p>The run time of a chunk of code can be measured by taking the difference between the time at the start and at the end of the code chunk. Simple yet flexible <img class="emoji" title=":sunglasses:" alt=":sunglasses:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f60e.png" height="20" width="20">.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sleep_for_a_minute</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Sys.sleep</span><span class="p">(</span><span class="m">60</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="n">start_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Sys.time</span><span class="p">()</span><span class="w">
</span><span class="n">sleep_for_a_minute</span><span class="p">()</span><span class="w">
</span><span class="n">end_time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Sys.time</span><span class="p">()</span><span class="w">

</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="w">
</span><span class="c1"># Time difference of 1.000327 mins</span><span class="w">
</span></code></pre></div></div>

<h3 id="2-library-tictoc">2. Library <code class="highlighter-rouge">tictoc</code>
</h3>

<p>The functions <code class="highlighter-rouge">tic</code> and <code class="highlighter-rouge">toc</code> are used in the same manner for benchmarking as the just demonstrated <code class="highlighter-rouge">Sys.time</code>. However <code class="highlighter-rouge">tictoc</code> adds a lot more convenience to the whole.</p>

<p>The most recent development<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> version of <code class="highlighter-rouge">tictoc</code> can be installed from github:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"jabiru/tictoc"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>One can time a single code chunk:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tictoc</span><span class="p">)</span><span class="w">

</span><span class="n">tic</span><span class="p">(</span><span class="s2">"sleeping"</span><span class="p">)</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="s2">"falling asleep..."</span><span class="p">)</span><span class="w">
</span><span class="n">sleep_for_a_minute</span><span class="p">()</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="s2">"...waking up"</span><span class="p">)</span><span class="w">
</span><span class="n">toc</span><span class="p">()</span><span class="w">
</span><span class="c1"># [1] "falling asleep..."</span><span class="w">
</span><span class="c1"># [1] "...waking up"</span><span class="w">
</span><span class="c1"># sleeping: 60.026 sec elapsed</span><span class="w">
</span></code></pre></div></div>

<p>Or nest multiple timers:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tic</span><span class="p">(</span><span class="s2">"total"</span><span class="p">)</span><span class="w">
</span><span class="n">tic</span><span class="p">(</span><span class="s2">"data generation"</span><span class="p">)</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">50000</span><span class="o">*</span><span class="m">1000</span><span class="p">),</span><span class="w"> </span><span class="m">50000</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">runif</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">50000</span><span class="p">)</span><span class="w">
</span><span class="n">toc</span><span class="p">()</span><span class="w">
</span><span class="n">tic</span><span class="p">(</span><span class="s2">"model fitting"</span><span class="p">)</span><span class="w">
</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">X</span><span class="p">)</span><span class="w">
</span><span class="n">toc</span><span class="p">()</span><span class="w">
</span><span class="n">toc</span><span class="p">()</span><span class="w">
</span><span class="c1"># data generation: 3.792 sec elapsed</span><span class="w">
</span><span class="c1"># model fitting: 39.278 sec elapsed</span><span class="w">
</span><span class="c1"># total: 43.071 sec elapsed</span><span class="w">
</span></code></pre></div></div>

<h3 id="3-using-systemtime">3. Using <code class="highlighter-rouge">system.time</code>
</h3>

<p>One can time the evaluation of an R expression using <code class="highlighter-rouge">system.time</code>. For example, we can use it to measure the execution time of the function <code class="highlighter-rouge">sleep_for_a_minute</code> (defined above) as follows.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">system.time</span><span class="p">({</span><span class="w"> </span><span class="n">sleep_for_a_minute</span><span class="p">()</span><span class="w"> </span><span class="p">})</span><span class="w">
</span><span class="c1">#   user  system elapsed</span><span class="w">
</span><span class="c1">#  0.004   0.000  60.051</span><span class="w">
</span></code></pre></div></div>

<p><strong>But what exactly are the reported times <code class="highlighter-rouge">user</code>, <code class="highlighter-rouge">system</code>, and <code class="highlighter-rouge">elapsed</code>?</strong> <img class="emoji" title=":confused:" alt=":confused:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f615.png" height="20" width="20"></p>

<p>Well, clearly <code class="highlighter-rouge">elapsed</code> is the wall clock time taken to execute the function <code class="highlighter-rouge">sleep_for_a_minute</code>, plus some benchmarking code wrapping it (that’s why it took slightly more than a minute to run I guess).</p>

<p>As for <code class="highlighter-rouge">user</code> and <code class="highlighter-rouge">system</code> times, <a href="http://r.789695.n4.nabble.com/Meaning-of-proc-time-td2303263.html#a2306691">William Dunlap has posted a great explanation to the r-help mailing list</a>:</p>

<blockquote>
  <p>“User CPU time” gives the CPU time spent by the current process (i.e., the current R session) and “system CPU time” gives the CPU time spent by the kernel (the operating system) on behalf of the current process.  The operating system is used for things like opening files, doing input or output, starting other processes, and looking at the system clock:  operations that involve resources that many processes must share.  Different operating systems will have different things done by the operating system.</p>
</blockquote>

<p><img class="emoji" title=":grinning:" alt=":grinning:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f600.png" height="20" width="20"></p>

<h3 id="4-library-rbenchmark">4. Library <code class="highlighter-rouge">rbenchmark</code>
</h3>

<p>The documentation to the function <code class="highlighter-rouge">benchmark</code> from the <code class="highlighter-rouge">rbenchmark</code> R package describes it as “a simple wrapper around <code class="highlighter-rouge">system.time</code>”. However it adds a lot of convenience compared to bare <code class="highlighter-rouge">system.time</code> calls. For example it requires just one <code class="highlighter-rouge">benchmark</code> call to time multiple replications of multiple expressions. Additionally the returned results are conveniently organized in a data frame.</p>

<p>I installed the development<sup id="fnref:1:1"><a href="#fn:1" class="footnote">1</a></sup> version of the <code class="highlighter-rouge">rbenchmark</code> package from github:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"eddelbuettel/rbenchmark"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>For example purposes, let’s compare the time required to compute linear regression coefficients using three alternative computational procedures:</p>
<ol>
  <li>
<code class="highlighter-rouge">lm</code>,</li>
  <li>the Moore-Penrose pseudoinverse,</li>
  <li>the Moore-Penrose pseudoinverse but without explicit matrix inverses.</li>
</ol>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rbenchmark</span><span class="p">)</span><span class="w">

</span><span class="n">benchmark</span><span class="p">(</span><span class="s2">"lm"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="p">),</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
            </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="w">
            </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="s2">"pseudoinverse"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="p">),</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
            </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="w">
            </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">y</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="s2">"linear system"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="p">),</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
            </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="w">
            </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="n">replications</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w">
          </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"test"</span><span class="p">,</span><span class="w"> </span><span class="s2">"replications"</span><span class="p">,</span><span class="w"> </span><span class="s2">"elapsed"</span><span class="p">,</span><span class="w">
                      </span><span class="s2">"relative"</span><span class="p">,</span><span class="w"> </span><span class="s2">"user.self"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sys.self"</span><span class="p">))</span><span class="w">

</span><span class="c1">#            test replications elapsed relative user.self sys.self</span><span class="w">
</span><span class="c1"># 3 linear system         1000   0.167    1.000     0.208    0.240</span><span class="w">
</span><span class="c1"># 1            lm         1000   0.930    5.569     0.952    0.212</span><span class="w">
</span><span class="c1"># 2 pseudoinverse         1000   0.240    1.437     0.332    0.612</span><span class="w">
</span></code></pre></div></div>

<p>Here, the meaning of <code class="highlighter-rouge">elapsed</code>, <code class="highlighter-rouge">user.self</code>, and <code class="highlighter-rouge">sys.self</code> is the same as described above in the section about <code class="highlighter-rouge">system.time</code>, and <code class="highlighter-rouge">relative</code> is simply the time ratio with the fastest test. Interestingly <code class="highlighter-rouge">lm</code> is by far the slowest here.</p>

<h3 id="5-library-microbenchmark">5. Library <code class="highlighter-rouge">microbenchmark</code>
</h3>

<p>The most recent development version of <code class="highlighter-rouge">microbenchmark</code> can be installed from github:</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"olafmersmann/microbenchmarkCore"</span><span class="p">)</span><span class="w">
</span><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"olafmersmann/microbenchmark"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Much like <code class="highlighter-rouge">benchmark</code> from the package <code class="highlighter-rouge">rbenchmark</code>, the function <code class="highlighter-rouge">microbenchmark</code> can be used to compare running times of multiple R code chunks. But it offers a great deal of convenience and additional functionality.</p>

<p>I find that one particularly nice feature of <code class="highlighter-rouge">microbenchmark</code> is the ability to automatically check the results of the benchmarked expressions with a user-specified function. This is demonstrated below, where we again compare three methods computing the coefficient vector of a linear model.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">microbenchmark</span><span class="p">)</span><span class="w">

</span><span class="n">set.seed</span><span class="p">(</span><span class="m">2017</span><span class="p">)</span><span class="w">
</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">)</span><span class="w">

</span><span class="n">check_for_equal_coefs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">tol</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1e-12</span><span class="w">
  </span><span class="n">max_error</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">values</span><span class="p">[[</span><span class="m">2</span><span class="p">]]),</span><span class="w">
                     </span><span class="nf">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">values</span><span class="p">[[</span><span class="m">3</span><span class="p">]]),</span><span class="w">
                     </span><span class="nf">abs</span><span class="p">(</span><span class="n">values</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">values</span><span class="p">[[</span><span class="m">3</span><span class="p">]])))</span><span class="w">
  </span><span class="n">max_error</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tol</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">mbm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">microbenchmark</span><span class="p">(</span><span class="s2">"lm"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="o">$</span><span class="n">coef</span><span class="w"> </span><span class="p">},</span><span class="w">
               </span><span class="s2">"pseudoinverse"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
                 </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">y</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="s2">"linear system"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
                 </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w"> </span><span class="o">%*%</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="n">check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">check_for_equal_coefs</span><span class="p">)</span><span class="w">

</span><span class="n">mbm</span><span class="w">
</span><span class="c1"># Unit: milliseconds</span><span class="w">
</span><span class="c1">#           expr      min        lq      mean    median        uq      max neval cld</span><span class="w">
</span><span class="c1">#             lm 96.12717 124.43298 150.72674 135.12729 188.32154 236.4910   100   c</span><span class="w">
</span><span class="c1">#  pseudoinverse 26.61816  28.81151  53.32246  30.69587  80.61303 145.0489   100  b</span><span class="w">
</span><span class="c1">#  linear system 16.70331  18.58778  35.14599  19.48467  22.69537 138.6660   100 a</span><span class="w">
</span></code></pre></div></div>

<p>We used the function argument <code class="highlighter-rouge">check</code> to check for equality (up to a maximal error of <code class="highlighter-rouge">1e-12</code>) of the results returned by the three methods. If the results weren’t equal, <code class="highlighter-rouge">microbenchmark</code> would return an error message.</p>

<p>Another great feature is the integration with <code class="highlighter-rouge">ggplot2</code> for plotting <code class="highlighter-rouge">microbenchmark</code> results.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">autoplot</span><span class="p">(</span><span class="n">mbm</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="../images/mbm.png" alt="Microbenchmark results plot"></p>

<h3 id="conclusion">Conclusion</h3>

<p>The given demonstration of the different benchmarking functions is surely not exhaustive. Nevertheless I made some conclusions for my personal benchmarking needs:</p>

<ul>
  <li>The <code class="highlighter-rouge">Sys.time</code> approach as well as the <code class="highlighter-rouge">tictoc</code> package can be used for timing (potentially nested) steps of a complicated algorithm (that’s often my use case). However, <code class="highlighter-rouge">tictoc</code> is more convenient, and (most importantly) foolproof.</li>
  <li>We saw that <code class="highlighter-rouge">microbenchmark</code> returns other types of measurements than <code class="highlighter-rouge">benchmark</code>, and I think that in most situations the <code class="highlighter-rouge">microbenchmark</code> measurements are of a higher practical significance <img class="emoji" title=":stuck_out_tongue:" alt=":stuck_out_tongue:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f61b.png" height="20" width="20">.</li>
  <li>To my knowledge <code class="highlighter-rouge">microbenchmark</code> is the only benchmarking package that has visualizations built in <img class="emoji" title=":+1:" alt=":+1:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f44d.png" height="20" width="20">.</li>
</ul>

<p>For these reasons I will go with <code class="highlighter-rouge">microbenchmark</code> and <code class="highlighter-rouge">tictoc</code>. <img class="emoji" title=":bowtie:" alt=":bowtie:" src="https://assets-cdn.github.com/images/icons/emoji/bowtie.png" height="20" width="20"></p>

<hr>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Though the repository does not seem to be very active. So the github version is probably no different from the stable release on CRAN. <a href="#fnref:1" class="reversefootnote">↩</a> <a href="#fnref:1:1" class="reversefootnote">↩<sup>2</sup></a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="date">
    Written on May 27, 2017
  </div>

  <div class="date">
    Tags:
    
    <a href="/tag/r">#r</a>
    
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'agisga';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
</div>

</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:alexej.go@gmail.com"><i class="svg-icon email"></i></a>
<a href="https://www.facebook.com/alexej.yexela"><i class="svg-icon facebook"></i></a>

<a href="https://github.com/agisga"><i class="svg-icon github"></i></a>

<a href="https://www.linkedin.com/in/alexejgossmann"><i class="svg-icon linkedin"></i></a>

<a href="/feed.xml"><i class="svg-icon rss"></i></a>




        </footer>
      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-94080131-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/benchmarking_r/',
		  'title': '5 ways to measure running time of R code'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>
